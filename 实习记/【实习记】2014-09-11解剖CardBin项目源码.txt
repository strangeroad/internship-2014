【实习记】2014-09-11解剖CardBin项目源码

经过昨天和今天两天的深入观察和学习源代码，下面是备忘录。

作用是根据卡号前12位找到数据库中的记录，数据库是以前多少位作为一条记录的。
项目编译后以so动态库形式作为server。

hash_shm.h
是共享内存的功能模板类，以数据结构类型初始化。
typedef hash_shm < CardBin, 6000, 100 > CardBinHash;
CardBinHash 是整个项目的功能类。

CardBinManager
这是整个项目的调用和管理者。
使用CardBinHash类作为底层工作者，是成员。
使用信号量锁住共享内存的写操作，信号量被封装成类，作为其成员使用。
使用ShmStatus类封装共享内存状态，也是成员。
使用CardBinDAO类封装数据库操作，也是成员。
但是其实以上封装都没有体现C++的优势，感觉是为封装而封装。

Init成员函数主要承担了动态库初始化工作，调用另外成员函数LoadIfNotReady装载数据库。
GetCardBin成员函数重载了两次，分别承担单查询和批量查询工作。

使用的单例设计模式
typedef Singleton < CardBinManager > CardBinManagerS;


关于算法
使用了哈希，但我一直没能想通其算法。
只知道是按最长匹配的思路匹配的。插入操作的代码很负责。

我的数据结构和算法还不够。


Unix进程间通信
差资料巩固了这方面知识。
1、管道
2、信号
3、信号量
4、消息队列
5、共享内存

管道是特殊的文件
信号与中断很像，软件层对应硬间层
信号量英文名意思是旗语，主要实现临界区访问的
消息队列，微内核的系统内核与各组件通信采用它，windows，minx
共享内存速度最快，但需要其他IPC机制辅助。





